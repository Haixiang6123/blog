<!DOCTYPE html>
<html>
<head>
    <title>Redux basic example</title>
</head>
<body>
<div>
    <div id="app">
    </div>
</div>
<script src="https://unpkg.com/redux@latest/dist/redux.min.js"></script>
<script>
    function add1() {
        store.dispatch({ type: 'add', payload: 1 }) // 1. dispatch 一个 action
    }
    function add2() {
        store.dispatch({ type: 'add', payload: 2})
    }
    function addIfOdd() {
        let prevState = store.getState()
        if (prevState % 2 === 1) {
            store.dispatch({ type: 'add', payload: 1 }) // 1. dispatch 一个 action
        }
    }
    function addAsync() {
        setTimeout(() => {
            store.dispatch({ type: 'add', payload: 1 }) // 1. dispatch 一个 action
        }, 2000)
    }
    function render(store) {
        let app = document.querySelector('#app')
        app.innerHTML = `
        Clicked: <span id="value">${store.getState()}</span> times
        <div>
            <button id="add1" onclick="add1()">+1</button>
            <button id="add2" onclick="add2()">+2</button>
            <button id="addIfOdd" onclick="addIfOdd()">Increment if odd</button>
            <button id="addAsync" onclick="addAsync()">Increment async</button>
        </div> `
    }

    function stateChanger(state, action) {
        if (state === undefined) {
           return 0
        }
        else {
            if (action.type === 'add') {
                let newState = state + action.payload
                return newState // 2. 根据操作生成新的 state 触发一个事件
            }
        }
    }

    let store = Redux.createStore(stateChanger)

    render(store)
    store.subscribe(() => {
        render(store) // 3. 接收到事件，重新 render
    })
</script>
</body>
</html>
